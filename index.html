<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mochila 0/1 - Interativo Manual</title>
<style>
body{font-family:Arial, sans-serif;padding:18px;background:#f7f9fb;color:#111}
h1{font-size:22px;margin-bottom:12px}
.input-row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
input[type="number"], input[type="text"]{padding:6px 8px;border-radius:6px;border:1px solid #cbd5e1;width:60px;text-align:right}
input[type="text"]{width:200px;text-align:left}
button{padding:8px 12px;border-radius:6px;border:none;cursor:pointer;background:#2563eb;color:white}
button.secondary{background:#64748b}
table{border-collapse:collapse;margin-top:12px}
th,td{border:1px solid #999;padding:6px;text-align:right}
.status{padding:8px;border-radius:6px;margin-top:10px}
.ok{background:#dcfce7;color:#065f46}
.error{background:#fee2e2;color:#9b1c1c}
</style>
</head>
<body>

<h1>Mochila 0/1 - Passo a Passo Manual</h1>

<div class="input-row">
<label>Aluno:</label>
<input id="studentName" type="text" placeholder="Digite seu nome"/>
<label>Itens (n):</label>
<input id="nItems" type="number" value="3" min="1"/>
<label>Capacidade (W):</label>
<input id="capacity" type="number" value="5" min="1"/>
<button id="build">Gerar Itens</button>
</div>

<div id="formArea"></div>
<div id="tableArea"></div>
<div id="feedback" class="status">Preencha os pesos e valores e clique em Criar Tabela DP.</div>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
// --- Dados ---
let problem=null, optimalDP=null;

// --- Gerar inputs de itens ---
function renderForm(){
  const n = +document.getElementById('nItems').value;
  const form = document.getElementById('formArea');
  form.innerHTML='<strong>Insira pesos e valores:</strong><br/>';
  for(let i=0;i<n;i++){
    const row = document.createElement('div');
    row.className='input-row';
    row.innerHTML = `Item ${i+1}: Peso <input type="number" id="w_${i}" value="1"/> Valor <input type="number" id="v_${i}" value="1"/>`;
    form.appendChild(row);
  }
  const btn = document.createElement('button');
  btn.innerText='Criar Tabela DP';
  btn.addEventListener('click', buildTable);
  form.appendChild(btn);
  document.getElementById('tableArea').innerHTML='';
  document.getElementById('feedback').innerText='Agora você pode preencher a tabela DP manualmente.';
}

// --- Ler problema ---
function readProblem(){
  const n = +document.getElementById('nItems').value;
  const W = +document.getElementById('capacity').value;
  const w=[], v=[];
  for(let i=0;i<n;i++){
    w.push(+document.getElementById(`w_${i}`).value);
    v.push(+document.getElementById(`v_${i}`).value);
  }
  return {n,W,w,v};
}

// --- Criar tabela DP vazia para o aluno preencher ---
function buildTable(){
  problem = readProblem();
  const {n,W}=problem;
  optimalDP = Array.from({length:n+1},()=>Array(W+1).fill(0));
  
  // calcular solução ótima para verificação
  const {w,v} = problem;
  for(let i=1;i<=n;i++){
    for(let j=0;j<=W;j++){
      if(w[i-1]<=j){
        optimalDP[i][j]=Math.max(optimalDP[i-1][j], optimalDP[i-1][j-w[i-1]]+v[i-1]);
      } else {
        optimalDP[i][j]=optimalDP[i-1][j];
      }
    }
  }

  renderStudentTable();
}

// --- Renderizar tabela para o aluno preencher ---
function renderStudentTable(){
  const {n,W} = problem;
  const container = document.getElementById('tableArea');
  container.innerHTML='<strong>Preencha a tabela DP manualmente:</strong>';
  const tbl = document.createElement('table');
  const thead = document.createElement('thead');
  let htr = document.createElement('tr');
  htr.appendChild(document.createElement('th'));
  for(let j=0;j<=W;j++){
    const th = document.createElement('th'); th.innerText=j;
    htr.appendChild(th);
  }
  thead.appendChild(htr);
  tbl.appendChild(thead);

  const tbody = document.createElement('tbody');
  for(let i=0;i<=n;i++){
    const tr = document.createElement('tr');
    const td0 = document.createElement('td'); td0.innerText=i; tr.appendChild(td0);
    for(let j=0;j<=W;j++){
      const td = document.createElement('td');
      const input = document.createElement('input');
      input.type='number'; input.style.width='60px'; input.dataset.i=i; input.dataset.j=j;
      td.appendChild(input);
      tr.appendChild(td);
    }
    tbody.appendChild(tr);
  }
  tbl.appendChild(tbody);
  container.appendChild(tbl);

  const btnCheck = document.createElement('button');
  btnCheck.innerText='Verificar Tabela';
  btnCheck.style.marginTop='10px';
  btnCheck.addEventListener('click', checkTable);
  container.appendChild(btnCheck);
}

// --- Verificar tabela do aluno e gerar nota ---
function checkTable(){
  const studentName = document.getElementById('studentName').value.trim();
  if(!studentName){
    alert('Por favor, digite o nome do aluno!');
    return;
  }

  const inputs = document.querySelectorAll('#tableArea input[type="number"]');
  let correctCount = 0;
  inputs.forEach(inp=>{
    const i = +inp.dataset.i;
    const j = +inp.dataset.j;
    const val = +inp.value;
    if(val === optimalDP[i][j]) correctCount++;
  });

  const totalCells = inputs.length;
  const score = Math.round((correctCount / totalCells) * 100);

  const fb = document.getElementById('feedback');
  if(score === 100){
    fb.innerText=`✅ Parabéns, ${studentName}! Tabela correta. Nota: ${score}/100`;
    fb.className='status ok';
  } else {
    fb.innerText=`❌ Alguns valores estão incorretos. Nota: ${score}/100`;
    fb.className='status error';
  }

  // botão para baixar PDF
  addDownloadButton(studentName, score, correctCount, totalCells);
}

// --- Adicionar botão de download do PDF ---
function addDownloadButton(name, score, correct, total){
  // remover botão antigo se houver
  const existingBtn = document.getElementById('downloadPDF');
  if(existingBtn) existingBtn.remove();

  const btn = document.createElement('button');
  btn.id='downloadPDF';
  btn.innerText='Baixar Relatório em PDF';
  btn.style.marginTop='10px';
  btn.addEventListener('click', ()=>{
    generatePDF(name, score, correct, total);
  });
  document.getElementById('tableArea').appendChild(btn);
}

// --- Gerar PDF com jsPDF ---
function generatePDF(name, score, correct, total){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(16);
  doc.text('Relatório de Desempenho - Mochila 0/1', 20, 20);
  doc.setFontSize(12);
  doc.text(`Aluno: ${name}`, 20, 35);
  doc.text(`Nota: ${score}/100`, 20, 45);
  doc.text(`Células corretas: ${correct} de ${total}`, 20, 55);
  doc.text('Detalhes da tabela DP podem ser revisados na tela.', 20, 65);
  doc.save(`Relatorio_${name.replace(/\s+/g,'_')}.pdf`);
}

// --- Eventos ---
document.getElementById('build').addEventListener('click', renderForm);

</script>

</body>
</html>
